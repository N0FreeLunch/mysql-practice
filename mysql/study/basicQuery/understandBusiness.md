## 테이블은 현실세계의 추상화이다.
- 테이블이 작성되는 것은 현실세계의 어떤 문제를 해결하기 위해서 만들어지는 것이다.
- 테이블에서 자료를 뽑기 위해서는 테이블이 어떤 의도로 만들어졌는지 알 수 있어야 한다.
- 이를 이해하기 위해서는 애플리케이션을 살펴 볼 필요도 있지만 어느정도는 데이터베이스를 어떻게 정의했는지를 통해서 추론할 수 있다.

## member 테이블
```
CREATE TABLE member -- 회원 테이블
( mem_id  		CHAR(8) NOT NULL PRIMARY KEY, -- 사용자 아이디(PK)
  mem_name    	VARCHAR(10) NOT NULL, -- 이름
  mem_number    INT NOT NULL,  -- 인원수
  addr	  		CHAR(2) NOT NULL, -- 지역(경기,서울,경남 식으로 2글자만입력)
  phone1		CHAR(3), -- 연락처의 국번(02, 031, 055 등)
  phone2		CHAR(8), -- 연락처의 나머지 전화번호(하이픈제외)
  height    	SMALLINT,  -- 평균 키
  debut_date	DATE  -- 데뷔 일자
);
```
- 이 비즈니스에서 말하는 멤버가 어떤 멤버인지 확인을 해 보자.
- 데이터베이스 이름은 `market_db`이다. 마켓 데이터베이스이므로 상품을 판다는 의미를 가지고 있다. `buy`테이블에서는 `mem_id`를 참조하고 있는 형태이다.

### 비즈니스에 부적합한 엔티티
#### 부적합한 엔티티
- `member`는 상품을 구매하는 회원이라고 추측할 수 있다. 그런데 문제는 상품을 팔기 위해서는 회원의 아이디, 이름, 주소, 전화번호 필수적인 것에 반해 키, 데뷔일자, 인원수는 비즈니스에 전혀 필요하지 않은 요소라는 것이다.

#### 인원수 컬럼의 부적합
- 특히 인원수 부분은 부적절한데 상품이란 기본적으로 개인에게 보내는 것이 현실 세계의 일반룰인데 인원수가 있다는 것은 어떤 그룹을 대상으로 아이템을 배송하는 것인지 아이템을 상품의 정보를 위해서 존재하는 테이블인지 명확히 알 수 없다는 문제가 생긴다.
- 일반적으로 어떤 이론이 있고 이를 설명하기 위한 근거를 제시하면서 모든 근거들이 이론을 잘 설명해야 더 가치가 있고 사실에 가까운 이론이 된다. 데이터베이스의 스키마와 데이터를 보고 어떤 비즈니스에 대한 것인지 이론을 제시하고 스키마와 데이터의 구성이 해당 비즈니스를 설명하기에 적절해야 하는데 이론으로 제시한 비즈니스 로직을 설명하지 못하는 데이터라면 이론의 설득력이 떨어지므로 이게 이 역할을 하는 테이블이 맞나 이런 비즈니스가 맞나라는 의문이 생기게 된다.
- 물건을 주문하고 상품을 받는 비즈니스를 구성하기 위한 회원정보를 입력하는 테이블에서 인원수라는 알 수 없는 엔티티가 존재한다는 것에서 추론을 불분명하게 한다.
- 심지어 인원수는 `not null` 제약사항을 가지고 있다. 멤버라는 것을 구성하기 위해서 인원수가 필수사항이라는 뜻을 가지고 있기 때문에 왜 인원수가 필요하지라는 의문을 해소하지 못하게 되고 어떠한 비즈니스인지 명확하게 추론하지 못하게 만든다.
- 애플리케이션의 로직을 보면 알 수 있겠지만 기본적으로 데이터베이스 테이블의 정보로만으로 추론 할 수 있어야 한다. 비즈니스를 표현하는데 있어서 부적절한 엔티티가 들어가게 되면 테이블이 어떤 목적으로 설계 되었는지 의미 추론 과정에서 혼동을 주게 된다. 
- 따라서 인원수는 멤버 테이블과 분리된 다른 어떤 비즈니스의 역할을 담당하는 테이블에 기재되어야 하는 정보이며 그렇게 분리된 테이블은 인원수를 가지고 무엇을 할 수 있는 비즈니스인지 테이블명으로 잘 표현을 해 주어야 한다.

#### 주소 컬럼의 부적합
- 현재 주소는 2글자의 지역으로 만들어 두었다. 상품을 배송할 위치를 정하는 테이블인데 2글자로 지역을 표기한다는 것은 정확한 배송 위치를 알 수 없다는 것이다. 따라서 멤버 테이블이 상품을 받는 사람의 정보가 맞는지 의문을 가지게 한다.
- 이런 제약사항을 근거로 멤버 테이블이 상품을 받는 사람의 주소가 아니라고 판단하는 경우의 수를 고려하게 되기 때문에 데이터베이스의 데이터를 통한 어떤 목적으로 설계된 테이블인지에 대한 추론에 혼동을 주게 된다.
- 물론 연습을 위해서 만든 테이블이라는 점을 고려해서 넘어갈 수 있는 문제이지만, 저장될 수 있는 데이터의 제약사항을 통해서도 어떤 비즈니스인지 추론하는 근거로 쓰이기 때문에 실전에서는 이러한 불확실한 비즈니스 문제를 야기하는 데이터의 제약사항을 만들지 말아야 한다.

### 부적합한 엔티티는 애플리케이션을 못 쓰는 구조로 만들어 버린다.
#### 인원수 뿐만 아니라 데뷔일자, 키 또한 부적합한 데이티이다.
- 인원수와 마찬가지로 데뷔일자가 테이블에 있어야 하는 이유를 알 수 없다. 프로그래밍 학습을 위해서 하나의 테이블에서 이것저것 데이터를 늘리려고 하다보니 이런 데이터마저 추가가 된 것으로 보인다.
- 하지만 가장 기초적으로 모든 테이블은 비즈니스 문제를 해결하기 위해서 만들어 져야 하고 비즈니스의 어떤 역할을 담당하는 데이터가 하나의 테이블에 들어가야 한다.
- 이런 자료를 보고 공부하게 되면 그저 데이터를 저장할 필요가 생겨서 컬럼 늘리는 게 테이블 추가하는 것 보다는 편하니까 멤버 테이블에 그냥 추가했어라는 왜 이렇게 하면 안 되는지에 대한 이유를 모른채 추가를 하는데 아무런 거리낌이 없게 된다.
- 애플리케이션의 역할이 다양해지고 많아짐에 따라서 해당 테이블이 어떤 목적을 위해 설계된 데이터베이스 스키마만 보고서는 것인지 파악하기 어렵게 되며, 역할별로 딱 필요한 데이터가 테이블에 들어가야 하는데 그렇지 못하게 되면서 비즈니스의 어떤 역할 쪽에서 이런 활용하기 위해 확인해야 하는 데이터와 그렇지 않은 데이터를 구분하지 못하게 하면서 기능의 변경, 추가를 하는데 어려움을 겪게하는 구조로 향하게 만든다.

## buy 테이블
```
CREATE TABLE buy -- 구매 테이블
(  num 		INT AUTO_INCREMENT NOT NULL PRIMARY KEY, -- 순번(PK)
   mem_id  	CHAR(8) NOT NULL, -- 아이디(FK)
   prod_name 	CHAR(6) NOT NULL, --  제품이름
   group_name 	CHAR(4)  , -- 분류
   price     	INT  NOT NULL, -- 가격
   amount    	SMALLINT  NOT NULL, -- 수량
   FOREIGN KEY (mem_id) REFERENCES member(mem_id)
);
```
- 멤버 테이블과 달리 구매 테이블은 어떤 목적인지 명확하게 알 수 있다.
- 상품을 구매 했으면 구매한 수량과 총 합계 가격 및 구매한 멤버가 누군인지 알아야 한다.

#### 구매당시 정보 기록의 의도 추측
- 제품 이름(prod_name)과 그룹 이름(group_name)은 원래 상품 테이블에 저장되는 정보이고 구매 테이블에서는 상품 테이블의 상품 아이디를 참조하는 방식으로 만들어져야 하지만, 유저가 구매한 시점의 상품 정보를 구매와 동시에 기록하려고 했다는 의도라고 파악할 수도 있다.
- 상품 테이블을 참조하는 방식이라면 상품의 정보가 변경되는 순간 구매자의 구매 시점 정보가 사라지기 때문에 유저 입장에서 불편한 요소가 될 수 있는 요소이기 때문에 상품 정보를 구매 정보와 함께 기록하는 것도 좋다.
- 하지만 구매와 구매할 때의 정보는 사실 서로 다른 책임을 가지고 있다고 생각할 수 있다. 구매에는 구매에 필요한 정보만 딱 위치하는 것이 좋다. 상품 구매 기록을 다른 테이블로 구분하는 방식을 고려해 볼 수도 있는 것이다. 이 문제는 비즈니스의 상황에 따라 판단이 달라질 수도 있는 문제일 수도 있다.
- 가격(price) 컬럼의 경우에는 쿠폰이나 세일 등에 의해 가격이 계속 변동될 수 있는 것이라서 구매 시점에 해당 가격을 구매정보와 같이 기록하는 것은 중요하다. 그리고 구매 이후의 과정을 진행하는데 있어서 지불정보 추적을 위해 구매 정보를 계속 참조할 것이므로 따로 테이블을 분리하지 않아도 될 항목으로 보인다.
- 또 다른 문제는 상품 원본의 정보를 기록하고 있는 테이블에 대한 참조가 없다는 것이다. 고객이 구매한 상품의 정보가 원래 무엇이었는지 확인할 수 있어야 한다. 상품종류와 상품이름이 같은 다른 버전의 상품도 있을 수 있기 때문에 상품 종류별 구분은 잘못된 제품을 고객에게 전달하지 않기 위해서 필수적인 항목이다.

## 데이터를 통해서 비즈니스 추측하기
### 멤버 테이블의 데이터로 추측하기
```
INSERT INTO member VALUES('TWC', '트와이스', 9, '서울', '02', '11111111', 167, '2015-10-19');
INSERT INTO member VALUES('BLK', '블랙핑크', 4, '경남', '055', '22222222', 163, '2016-08-08');
INSERT INTO member VALUES('WMN', '여자친구', 6, '경기', '031', '33333333', 166, '2015-01-15');
INSERT INTO member VALUES('OMY', '오마이걸', 7, '서울', NULL, NULL, 160, '2015-04-21');
INSERT INTO member VALUES('GRL', '소녀시대', 8, '서울', '02', '44444444', 168, '2007-08-02');
INSERT INTO member VALUES('ITZ', '잇지', 5, '경남', NULL, NULL, 167, '2019-02-12');
INSERT INTO member VALUES('RED', '레드벨벳', 4, '경북', '054', '55555555', 161, '2014-08-01');
INSERT INTO member VALUES('APN', '에이핑크', 6, '경기', '031', '77777777', 164, '2011-02-10');
INSERT INTO member VALUES('SPC', '우주소녀', 13, '서울', '02', '88888888', 162, '2016-02-25');
INSERT INTO member VALUES('MMU', '마마무', 4, '전남', '061', '99999999', 165, '2014-06-19');
```
- 멤버 이름은 걸그룹으로, 맴버 인원수는 걸그룹 맴버의 인원수로, 걸그룹이기 때문에 데뷔일이 존재하며, 연예인이기 때문에 평균키는 관심의 대상이 된다.
- 물론 이런 정보가 마켓이란 비즈니스의 회원 정보에 필수적이거나 필요하거나 비즈니스를 구성할 때 쓸모있는 정보가 될 수 있지는 않지만, 테이블의 데이터의 확인 없이 스키마만 보고서는 알 수 없었던 정보들을 알 수 있다. 가능한한 스키마를 구성할 때 비즈니스를 잘 추론할 수 있는 정보들을 갖추는 것이 좋지만, 이렇게 스키마만으로는 왜 존재하는지 알 수 없었던 인원수, 데뷔일, 평균키에 대한 정보가 왜 들어가 있는지 어떤 데이터가 들어가 있는지를 통해 알 수 있다.
- 물론 데이터를 통해서 인원수, 키, 데뷔일이 멤버가 주문을 하고 배송을 받는 대상의 정보라는 목적에 여전히 어긋나므로 적절한 컬럼의 데이터가 들어간 것은 아니지만 그래도 어떤 의도에서 추가된 컬럼인지 알수는 있게 해 준다. 하지만 가능한 데이터베이스 스키마로 설명될 수 있는 정보들이 데이터에 들어가는 것이 옳다. 스키마로 설명되지 않고 데이터의 고유한 특성으로 설명되는 데이터라면 이번 예에서 확인할 수 있듯이 비즈니스 목적에서 벗어난 부적절한 데이터가 될 가능성이 높다.

### 구매 테이블의 데이터로 추측하기
```
INSERT INTO buy VALUES(NULL, 'BLK', '지갑', NULL, 30, 2);
INSERT INTO buy VALUES(NULL, 'BLK', '맥북프로', '디지털', 1000, 1);
INSERT INTO buy VALUES(NULL, 'APN', '아이폰', '디지털', 200, 1);
INSERT INTO buy VALUES(NULL, 'MMU', '아이폰', '디지털', 200, 5);
INSERT INTO buy VALUES(NULL, 'BLK', '청바지', '패션', 50, 3);
INSERT INTO buy VALUES(NULL, 'MMU', '에어팟', '디지털', 80, 10);
INSERT INTO buy VALUES(NULL, 'GRL', '혼공SQL', '서적', 15, 5);
INSERT INTO buy VALUES(NULL, 'APN', '혼공SQL', '서적', 15, 2);
INSERT INTO buy VALUES(NULL, 'APN', '청바지', '패션', 50, 1);
INSERT INTO buy VALUES(NULL, 'MMU', '지갑', NULL, 30, 1);
INSERT INTO buy VALUES(NULL, 'APN', '혼공SQL', '서적', 15, 1);
INSERT INTO buy VALUES(NULL, 'MMU', '지갑', NULL, 30, 4);
```
- `group_name`이라는 테이블이 무슨 역할을 하는지 스키마만 보고서는 어떤 종류의 그룹을 의미하는지 명확하게 알 수 없지만, 데이터를 보고서는 '디지털', '서적', '패션' 이런 분류를 갖는구나라는 것을 알 수가 있다. 그룹의 카테고리 제한이 어떻게 되어 있는지를 알 수 있는 것이다. 하지만 이런류의 데이터라면 `enum` 타입을 사용하여 스키마를 보고 어떤 종류의 카테고리가 있는지 알 수 있게 해 주는 방법도 좋은 방법이다.
- 하지만 `enum`이 무조건 좋은 방법은 아니다. 종류가 적은 경우네는 `enum`이 좋은 방법이지만 종류가 많은 경우에는 `enum`은 스키마를 계속 업데이트해야 하므로 좋지 않은 방법이다. 테이블을 분리하여 타입을 따로 적어서 타입 테이블의 아이디를 참조하는 방법도 사용할 수 있다. `enum`의 경우 확실히 정해진 것에 반해 테이블을 분리하는 것은 데이터를 저장하는 사람의 재량에 맡기는 형식이 되기 때문에 스키마를 통해서는 비즈니스의 세부적인 사항까지 알기 어렵다는 단점이 있기는 하다.


## 부적절한 스키마는 도메인적 표현의 서술을 어렵게 한다.
- 멤버 테이블의 하나의 대상은 멤버를 가리킨다. 멤버란 어떤 그룹에 속해 있는 사람을 의미하는 말이다. 그리고 인원수는 멤버가 속한 그룹에 속한 멤버수를 가리킨다. 그런데 문제는 데이터가 걸그룹으로 넣어지고 있다는 것이다. 테이블 명이 멤버이면 그냥 일반 유저이든가 걸그룹에 속한 어느 누구여야 자연스러운데 멤버 테이블인데 아이돌 그룹이 위치하고 있다. 이럴 거면 멤버 테이블의 이름을 `idol groups`라고 표현하는 편이 좋다. 하지만 이러면 `member` 테이블이라면 마켓이란 서비스의 회원을 의미하는 좋은 표현이지만 `idol_groups`는 이게 상품 구매의 대상인가?라는 의문이 드는 이름이 되기 때문에 좋지 못하다. 애초에 비즈니스의 정합성을 해치는 데이터로 구성한 것이 비즈니스를 설명하는데 있어서 계속적인 문제를 야기한다.
- 이런 데이터를 갖는 대상으로 비즈니스 설명을 하기 위해서는 스키마로는 설명될 수 없고 부적절하기 때문에 스키마 이외의 추가적인 설명을 필요로 한다. 멤버 테이블의 멤버는 어떤 사람이 아닌 걸그룹을 의미하며 걸그룹을 하나의 상품 구매와 배송의 대상으로 본다. 또한 상품을 구매하고 배송하는데 필요한 정보는 아니지만 걸그룹이라면 사람들이 관심을 가질만한 정보인 평균 키, 인원수, 데뷔일 등의 정보를 포함하고 있다라는 추가적인 정보가 전제된 상태에서 데이터베이스를 다룰 수 있도록 해야 한다.

### 용어의 혼동을 방지하는 스키마 설계
- 멤버 테이블의 멤버와 걸그룹 내의 멤버는 엄연히 다른 대상이지만 테이블을 통해서 도메인 로직을 만들어야 할 때 걸그룹의 맴버와 멤버 테이블의 멤버를 구분해서 사용해야 하는데 도메인 용어는 개발자만 사용하는 것이 아니라 시스템을 만들어 다양한 직무의 사람, 운용하는 사람 모두가 이해할 수 있어야 한다. 따라서 테이블의 멤버라는 용어는 적절하지 못하다. 따라서 테이블의 멤버를 회원(=member)라고 부르도록 하자. 그리고 걸그룹의 멤버는 단순히 멤버라고 말하는 것이 아니라 항상 '걸그룹의'라고 붙여서 걸그룹의 멤버라고 하자.
- 사실 가장 좋은 것은 테이블명 및 컬럼명에서 `member`라는 용어를 제거하고 'users'를 쓰던가 걸그룹의 멤버에만 멤버를 쓰는 것이 좋다.